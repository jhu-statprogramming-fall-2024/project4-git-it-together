<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nhi Dinh">

<title>Final Project: Machine Learning Model Building and Results</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="model_building_files/libs/clipboard/clipboard.min.js"></script>
<script src="model_building_files/libs/quarto-html/quarto.js"></script>
<script src="model_building_files/libs/quarto-html/popper.min.js"></script>
<script src="model_building_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="model_building_files/libs/quarto-html/anchor.min.js"></script>
<link href="model_building_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="model_building_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="model_building_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="model_building_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="model_building_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Final Project: Machine Learning Model Building and Results</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nhi Dinh </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
</section>
<section id="part-1" class="level2">
<h2 class="anchored" data-anchor-id="part-1">Part 1</h2>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data preparation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>p1_wide <span class="ot">&lt;-</span> p1_wide <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>period)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>p1_long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  p1_wide,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="sc">-</span>year,  <span class="co"># Exclude the 'year' column from pivoting</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">"variable"</span>,  <span class="co"># Name for the new column holding the old column names</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">"value"</span>  <span class="co"># Name for the new column holding the values</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the 'variable' column into 'race' and 'sex'</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>p1_long <span class="ot">&lt;-</span> p1_long <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(variable, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"race"</span>, <span class="st">"sex"</span>), <span class="at">sep =</span> <span class="st">"_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="linear-model" class="level3">
<h3 class="anchored" data-anchor-id="linear-model">Linear model</h3>
<section id="visualization" class="level4">
<h4 class="anchored" data-anchor-id="visualization">Visualization</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> p1_long <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> value, <span class="at">color =</span> race, <span class="at">linetype =</span> sex,  <span class="at">group =</span> <span class="fu">interaction</span>(race, sex))) <span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()  <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Race"</span>, <span class="at">linetype =</span> <span class="st">"Sex"</span>) <span class="sc">+</span>  <span class="co"># Add legend labels</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Mean Weekly income"</span>) <span class="sc">+</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="model_building_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="models" class="level4">
<h4 class="anchored" data-anchor-id="models">Models</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(value <span class="sc">~</span> year <span class="sc">+</span> race <span class="sc">+</span> sex, <span class="at">data =</span> p1_long)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = value ~ year + race + sex, data = p1_long)

Residuals:
    Min      1Q  Median      3Q     Max 
-43.485 -14.219  -1.006  17.141  36.124 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -55435.354   2292.770 -24.178  &lt; 2e-16 ***
year            27.794      1.136  24.476  &lt; 2e-16 ***
raceblack      -55.556      7.182  -7.735 4.86e-10 ***
racewhite       -3.000      7.182  -0.418    0.678    
sexwomen      -103.815      5.864 -17.703  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 21.55 on 49 degrees of freedom
Multiple R-squared:  0.9528,    Adjusted R-squared:  0.9489 
F-statistic:   247 on 4 and 49 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Machine learning model training</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Split the data into training and test sets</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12062024</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the index for 80% training and 20% testing</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(p1_long<span class="sc">$</span>value, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> p1_long[train_index, ]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> p1_long[<span class="sc">-</span>train_index, ]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Machine learning model: Linear regression model to predict a country's GINI inedex </span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the training control (10-fold cross-validation)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Train the model using caret or tiny models</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">train</span>(value <span class="sc">~</span> year <span class="sc">+</span> race <span class="sc">+</span> sex, </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> train_data,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"lm"</span>,      <span class="co"># Custom model method</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trControl =</span> train_control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Understand model results</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-42.168 -14.323  -1.982  16.073  36.449 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -55414.214   2436.221 -22.746  &lt; 2e-16 ***
year            27.785      1.207  23.026  &lt; 2e-16 ***
raceblack      -58.244      7.998  -7.282  6.6e-09 ***
racewhite       -7.292      8.020  -0.909    0.369    
sexwomen      -100.990      6.585 -15.337  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22.24 on 41 degrees of freedom
Multiple R-squared:  0.9535,    Adjusted R-squared:  0.949 
F-statistic: 210.4 on 4 and 41 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assess the model performance both the training and test dataset using Root mean squared error (RMSE)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Make predictions on the test set</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model, <span class="at">newdata =</span> test_data)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Combine actual vs predicted values</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Actual =</span> test_data<span class="sc">$</span>value, <span class="at">Predicted =</span> predictions)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">## View the results</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Actual Predicted
1    505  519.1309
2    528  554.2077
3    670  647.9052
4    523  523.7481
5    723  703.4745
6    614  637.5616</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate RMSE, R-squared, and MAE</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>model_eval <span class="ot">&lt;-</span> <span class="fu">postResample</span>(predictions, test_data<span class="sc">$</span>value)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="do">## View performance metrics</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(p1_long<span class="sc">$</span>value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  440.0   524.8   600.5   610.2   669.5   820.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_eval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      RMSE   Rsquared        MAE 
18.5793762  0.9460597 17.0322836 </code></pre>
</div>
</div>
<p>Data frame to predict the outcome up to 2050</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the ranges for each predictor</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">2025</span><span class="sc">:</span><span class="dv">2050</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>races <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>, <span class="st">"asian"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sexes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"women"</span>, <span class="st">"men"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create all combinations of year, race, and sex</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>future_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> years,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">race =</span> races,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> sexes</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="predict-outcome-up-to-2050" class="level3">
<h3 class="anchored" data-anchor-id="predict-outcome-up-to-2050">Predict outcome up to 2050</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict outcomes for future_data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>future_data<span class="sc">$</span>predicted_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model, <span class="at">newdata =</span> future_data)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View predictions</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(future_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    year  race   sex predicted_value
1   2025 black women        690.4559
2   2026 black women        718.2406
3   2027 black women        746.0252
4   2028 black women        773.8099
5   2029 black women        801.5945
6   2030 black women        829.3792
7   2031 black women        857.1638
8   2032 black women        884.9485
9   2033 black women        912.7331
10  2034 black women        940.5177
11  2035 black women        968.3024
12  2036 black women        996.0870
13  2037 black women       1023.8717
14  2038 black women       1051.6563
15  2039 black women       1079.4410
16  2040 black women       1107.2256
17  2041 black women       1135.0102
18  2042 black women       1162.7949
19  2043 black women       1190.5795
20  2044 black women       1218.3642
21  2045 black women       1246.1488
22  2046 black women       1273.9335
23  2047 black women       1301.7181
24  2048 black women       1329.5028
25  2049 black women       1357.2874
26  2050 black women       1385.0720
27  2025 white women        741.4081
28  2026 white women        769.1927
29  2027 white women        796.9774
30  2028 white women        824.7620
31  2029 white women        852.5466
32  2030 white women        880.3313
33  2031 white women        908.1159
34  2032 white women        935.9006
35  2033 white women        963.6852
36  2034 white women        991.4699
37  2035 white women       1019.2545
38  2036 white women       1047.0392
39  2037 white women       1074.8238
40  2038 white women       1102.6084
41  2039 white women       1130.3931
42  2040 white women       1158.1777
43  2041 white women       1185.9624
44  2042 white women       1213.7470
45  2043 white women       1241.5317
46  2044 white women       1269.3163
47  2045 white women       1297.1009
48  2046 white women       1324.8856
49  2047 white women       1352.6702
50  2048 white women       1380.4549
51  2049 white women       1408.2395
52  2050 white women       1436.0242
53  2025 asian women        748.7002
54  2026 asian women        776.4849
55  2027 asian women        804.2695
56  2028 asian women        832.0541
57  2029 asian women        859.8388
58  2030 asian women        887.6234
59  2031 asian women        915.4081
60  2032 asian women        943.1927
61  2033 asian women        970.9774
62  2034 asian women        998.7620
63  2035 asian women       1026.5467
64  2036 asian women       1054.3313
65  2037 asian women       1082.1159
66  2038 asian women       1109.9006
67  2039 asian women       1137.6852
68  2040 asian women       1165.4699
69  2041 asian women       1193.2545
70  2042 asian women       1221.0392
71  2043 asian women       1248.8238
72  2044 asian women       1276.6085
73  2045 asian women       1304.3931
74  2046 asian women       1332.1777
75  2047 asian women       1359.9624
76  2048 asian women       1387.7470
77  2049 asian women       1415.5317
78  2050 asian women       1443.3163
79  2025 black   men        791.4456
80  2026 black   men        819.2303
81  2027 black   men        847.0149
82  2028 black   men        874.7995
83  2029 black   men        902.5842
84  2030 black   men        930.3688
85  2031 black   men        958.1535
86  2032 black   men        985.9381
87  2033 black   men       1013.7228
88  2034 black   men       1041.5074
89  2035 black   men       1069.2921
90  2036 black   men       1097.0767
91  2037 black   men       1124.8613
92  2038 black   men       1152.6460
93  2039 black   men       1180.4306
94  2040 black   men       1208.2153
95  2041 black   men       1235.9999
96  2042 black   men       1263.7846
97  2043 black   men       1291.5692
98  2044 black   men       1319.3539
99  2045 black   men       1347.1385
100 2046 black   men       1374.9231
101 2047 black   men       1402.7078
102 2048 black   men       1430.4924
103 2049 black   men       1458.2771
104 2050 black   men       1486.0617
105 2025 white   men        842.3977
106 2026 white   men        870.1824
107 2027 white   men        897.9670
108 2028 white   men        925.7517
109 2029 white   men        953.5363
110 2030 white   men        981.3210
111 2031 white   men       1009.1056
112 2032 white   men       1036.8902
113 2033 white   men       1064.6749
114 2034 white   men       1092.4595
115 2035 white   men       1120.2442
116 2036 white   men       1148.0288
117 2037 white   men       1175.8135
118 2038 white   men       1203.5981
119 2039 white   men       1231.3828
120 2040 white   men       1259.1674
121 2041 white   men       1286.9520
122 2042 white   men       1314.7367
123 2043 white   men       1342.5213
124 2044 white   men       1370.3060
125 2045 white   men       1398.0906
126 2046 white   men       1425.8753
127 2047 white   men       1453.6599
128 2048 white   men       1481.4445
129 2049 white   men       1509.2292
130 2050 white   men       1537.0138
131 2025 asian   men        849.6899
132 2026 asian   men        877.4745
133 2027 asian   men        905.2592
134 2028 asian   men        933.0438
135 2029 asian   men        960.8285
136 2030 asian   men        988.6131
137 2031 asian   men       1016.3977
138 2032 asian   men       1044.1824
139 2033 asian   men       1071.9670
140 2034 asian   men       1099.7517
141 2035 asian   men       1127.5363
142 2036 asian   men       1155.3210
143 2037 asian   men       1183.1056
144 2038 asian   men       1210.8903
145 2039 asian   men       1238.6749
146 2040 asian   men       1266.4595
147 2041 asian   men       1294.2442
148 2042 asian   men       1322.0288
149 2043 asian   men       1349.8135
150 2044 asian   men       1377.5981
151 2045 asian   men       1405.3828
152 2046 asian   men       1433.1674
153 2047 asian   men       1460.9521
154 2048 asian   men       1488.7367
155 2049 asian   men       1516.5213
156 2050 asian   men       1544.3060</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;- Embed this new data frame in the dashboard </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="part-1b-only-include-gender-data-in-the-model" class="level2">
<h2 class="anchored" data-anchor-id="part-1b-only-include-gender-data-in-the-model">Part 1b: Only include gender data in the model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/nhidi/OneDrive - Johns Hopkins/PhD/courses/second-term/Programming/final-project/data"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>p1b_wide <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"service_occupation_annual.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-preparation-1" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation-1">Data preparation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>p1b_long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  p1b_wide,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="sc">-</span>year,  <span class="co"># Exclude the 'year' column from pivoting</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">"sex"</span>,  <span class="co"># Name for the new column holding the old column names</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">"value"</span>  <span class="co"># Name for the new column holding the values</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Update name </span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>p1b_long<span class="sc">$</span>sex[p1b_long<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"a_women"</span>] <span class="ot">&lt;-</span> <span class="st">"women"</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>p1b_long<span class="sc">$</span>sex[p1b_long<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"a_men"</span>] <span class="ot">&lt;-</span> <span class="st">"men"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="linear-model-1" class="level3">
<h3 class="anchored" data-anchor-id="linear-model-1">Linear model</h3>
<section id="visualization-1" class="level4">
<h4 class="anchored" data-anchor-id="visualization-1">Visualization</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> p1b_long <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> value, <span class="at">linetype =</span> sex)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()  <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">linetype =</span> <span class="st">"Sex"</span>) <span class="sc">+</span>  <span class="co"># Add legend labels</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Mean weekly income"</span>) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>plot2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="model_building_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="models-1" class="level4">
<h4 class="anchored" data-anchor-id="models-1">Models</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>model1b <span class="ot">&lt;-</span> <span class="fu">lm</span>(value <span class="sc">~</span> year <span class="sc">+</span> sex, <span class="at">data =</span> p1b_long)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = value ~ year + sex, data = p1b_long)

Residuals:
   Min     1Q Median     3Q    Max 
-40.83 -22.74  -0.56  14.64  74.30 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -2.641e+04  1.158e+03  -22.81   &lt;2e-16 ***
year         1.341e+01  5.757e-01   23.30   &lt;2e-16 ***
sexwomen    -1.116e+02  7.971e+00  -14.00   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 27.61 on 45 degrees of freedom
Multiple R-squared:  0.9426,    Adjusted R-squared:   0.94 
F-statistic: 369.3 on 2 and 45 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Machine learning model training</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Split the data into training and test sets</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12062024</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the index for 80% training and 20% testing</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(p1b_long<span class="sc">$</span>value, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>train_b_data <span class="ot">&lt;-</span> p1b_long[train_index, ]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>test_b_data <span class="ot">&lt;-</span> p1b_long[<span class="sc">-</span>train_index, ]</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Machine learning model: Linear regression model to predict a country's GINI inedex </span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the training control (10-fold cross-validation)</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>train_b_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Train the model using caret or tiny models</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>lm_model_b <span class="ot">&lt;-</span> <span class="fu">train</span>(value <span class="sc">~</span> year <span class="sc">+</span> sex, </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> train_b_data,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"lm"</span>,      </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trControl =</span> train_b_control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Understand model results</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_model_b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-39.615 -19.616  -3.204  15.922  75.530 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -2.600e+04  1.234e+03  -21.08  &lt; 2e-16 ***
year         1.321e+01  6.132e-01   21.54  &lt; 2e-16 ***
sexwomen    -1.132e+02  8.660e+00  -13.07 1.95e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 27.12 on 37 degrees of freedom
Multiple R-squared:  0.9495,    Adjusted R-squared:  0.9467 
F-statistic: 347.5 on 2 and 37 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assess the model performance both the training and test dataset using Root mean squared error (RMSE)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Make predictions on the test set</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>predictions_b <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model_b, <span class="at">newdata =</span> test_b_data)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Combine actual vs predicted values</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>results_b <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Actual =</span> test_b_data<span class="sc">$</span>value, <span class="at">Predicted =</span> predictions_b)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="do">## View the results</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(results_b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Actual Predicted
1 475.50  470.9951
2 420.25  410.6507
3 424.75  437.0692
4 436.25  463.4876
5 585.00  616.2965
6 501.25  529.5336</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate RMSE, R-squared, and MAE</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>model_eval_b <span class="ot">&lt;-</span> <span class="fu">postResample</span>(predictions_b, test_b_data<span class="sc">$</span>value)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="do">## View performance metrics</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(p1b_long<span class="sc">$</span>value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  325.0   431.9   497.4   513.2   583.9   797.5 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_eval_b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
30.036086  0.884157 22.942598 </code></pre>
</div>
</div>
<p>Data frame to predict the outcome up to 2050</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create all combinations of year, race, and sex</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>future_data_b <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> years,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> sexes</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="predict-outcome-up-to-2050-1" class="level3">
<h3 class="anchored" data-anchor-id="predict-outcome-up-to-2050-1">Predict outcome up to 2050</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict outcomes for future_data</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>future_data_b<span class="sc">$</span>predicted_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model_b, <span class="at">newdata =</span> future_data_b)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View predictions</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(future_data_b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year   sex predicted_value
1  2025 women        635.2073
2  2026 women        648.4166
3  2027 women        661.6258
4  2028 women        674.8350
5  2029 women        688.0442
6  2030 women        701.2534
7  2031 women        714.4626
8  2032 women        727.6718
9  2033 women        740.8811
10 2034 women        754.0903
11 2035 women        767.2995
12 2036 women        780.5087
13 2037 women        793.7179
14 2038 women        806.9271
15 2039 women        820.1363
16 2040 women        833.3455
17 2041 women        846.5548
18 2042 women        859.7640
19 2043 women        872.9732
20 2044 women        886.1824
21 2045 women        899.3916
22 2046 women        912.6008
23 2047 women        925.8100
24 2048 women        939.0193
25 2049 women        952.2285
26 2050 women        965.4377
27 2025   men        748.3886
28 2026   men        761.5978
29 2027   men        774.8070
30 2028   men        788.0163
31 2029   men        801.2255
32 2030   men        814.4347
33 2031   men        827.6439
34 2032   men        840.8531
35 2033   men        854.0623
36 2034   men        867.2715
37 2035   men        880.4807
38 2036   men        893.6900
39 2037   men        906.8992
40 2038   men        920.1084
41 2039   men        933.3176
42 2040   men        946.5268
43 2041   men        959.7360
44 2042   men        972.9452
45 2043   men        986.1544
46 2044   men        999.3637
47 2045   men       1012.5729
48 2046   men       1025.7821
49 2047   men       1038.9913
50 2048   men       1052.2005
51 2049   men       1065.4097
52 2050   men       1078.6189</code></pre>
</div>
</div>
</section>
</section>
<section id="part-2-education-industry" class="level1">
<h1>Part 2: Education Industry</h1>
<p>By industry, 12 month percentage employment, region</p>
<p>Ø Predict / Outcome (Y) : employment change</p>
<p>Ø Variables / Predictors (X) : year, state</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/nhidi/OneDrive - Johns Hopkins/PhD/courses/second-term/Programming/final-project/data"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>p1_education <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"education.xlsx"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(p1_education<span class="sc">$</span>year_quarter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:1800] "2014_Q_1" "2014_Q_1" "2014_Q_1" "2014_Q_1" "2014_Q_1" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Separate year and quarter</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>p1_education <span class="ot">&lt;-</span> p1_education <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(year_quarter, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"quarter"</span>), <span class="at">sep =</span> <span class="st">"_Q_"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create ordered factor</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>p1_education <span class="ot">&lt;-</span> p1_education <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_quarter_factor =</span> <span class="fu">factor</span>(</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(year, quarter, <span class="at">sep =</span> <span class="st">"_Q_"</span>),  <span class="co"># Combine year and quarter</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">paste</span>(year, quarter, <span class="at">sep =</span> <span class="st">"_Q_"</span>)),  <span class="co"># Ensure order by occurrence</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(p1_education<span class="sc">$</span>year_quarter_factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Ord.factor w/ 40 levels "2014_Q_1"&lt;"2014_Q_2"&lt;..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>p1_education<span class="sc">$</span>year_quarter_cont <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(p1_education<span class="sc">$</span>year_quarter_factor)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(p1_education<span class="sc">$</span>year_quarter_cont)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:1800] 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group data by average change by year</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#p1_education &lt;- p1_education %&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  group_by(state, year) %&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  reframe(</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    annual_change = mean(oty_month3_emplvl_pct_chg, na.rm = TRUE)</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  )</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">#p1_education$year &lt;- as.numeric(p1_education$year)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="model-building" class="level2">
<h2 class="anchored" data-anchor-id="model-building">Model building</h2>
<section id="visualization-2" class="level3">
<h3 class="anchored" data-anchor-id="visualization-2">Visualization</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> p1_education <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_quarter_factor, <span class="at">y =</span> oty_month3_emplvl_pct_chg, <span class="at">color =</span> state, <span class="at">group =</span> state)) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"% Job change"</span>) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>)  <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="co">#</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>plot3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="model_building_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Treat year/quarter as continuous, starting at 2014 Q1 =1, 2014 Q2 = 2</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>model_education <span class="ot">&lt;-</span> <span class="fu">lm</span>(oty_month3_emplvl_pct_chg <span class="sc">~</span> year_quarter_cont <span class="sc">+</span> state, <span class="at">data =</span> p1_education)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_education)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = oty_month3_emplvl_pct_chg ~ year_quarter_cont + 
    state, data = p1_education)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.8055  -0.5967   0.3502   1.2624   7.9005 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          1.683534   0.429166   3.923 9.09e-05 ***
year_quarter_cont    0.010437   0.005358   1.948 0.051561 .  
stateFlorida         0.905000   0.586720   1.542 0.123139    
stateGeorgia         0.897500   0.586720   1.530 0.126274    
stateHawaii         -0.702500   0.586720  -1.197 0.231338    
stateIdaho           1.492500   0.586720   2.544 0.011050 *  
stateIllinois       -0.837500   0.586720  -1.427 0.153635    
stateIndiana        -0.352500   0.586720  -0.601 0.548052    
stateIowa           -1.597500   0.586720  -2.723 0.006538 ** 
stateKansas         -0.757500   0.586720  -1.291 0.196848    
stateKentucky        0.005000   0.586720   0.009 0.993202    
stateLouisiana      -0.245000   0.586720  -0.418 0.676309    
stateMaine          -1.197500   0.586720  -2.041 0.041400 *  
stateMaryland       -0.735000   0.586720  -1.253 0.210472    
stateMassachusetts  -0.540000   0.586720  -0.920 0.357506    
stateMichigan       -1.102500   0.586720  -1.879 0.060398 .  
stateMinnesota      -0.372500   0.586720  -0.635 0.525586    
stateMississippi    -0.640000   0.586720  -1.091 0.275506    
stateMissouri       -0.575000   0.586720  -0.980 0.327209    
stateMontana        -0.295000   0.586720  -0.503 0.615171    
stateNebraska       -0.815000   0.586720  -1.389 0.164985    
stateNevada          2.145000   0.586720   3.656 0.000264 ***
stateNew Hampshire  -0.752500   0.586720  -1.283 0.199818    
stateNew Jersey      0.087500   0.586720   0.149 0.881465    
stateNew Mexico     -0.275000   0.586720  -0.469 0.639337    
stateNew York        0.490000   0.586720   0.835 0.403746    
stateNorth Carolina  0.062500   0.586720   0.107 0.915178    
stateNorth Dakota   -0.482500   0.586720  -0.822 0.410979    
stateOhio           -1.160000   0.586720  -1.977 0.048188 *  
stateOklahoma       -0.427500   0.586720  -0.729 0.466327    
stateOregon          1.135000   0.586720   1.934 0.053214 .  
statePennsylvania   -0.452500   0.586720  -0.771 0.440671    
statePuerto Rico    -1.817500   0.586720  -3.098 0.001981 ** 
stateRhode Island   -1.375000   0.586720  -2.344 0.019213 *  
stateSouth Carolina  0.910000   0.586720   1.551 0.121083    
stateSouth Dakota   -0.480000   0.586720  -0.818 0.413407    
stateTennessee      -0.075000   0.586720  -0.128 0.898299    
stateTexas           0.727500   0.586720   1.240 0.215162    
stateUtah            1.607500   0.586720   2.740 0.006210 ** 
stateVermont        -1.432500   0.586720  -2.442 0.014723 *  
stateVirgin Islands -1.445000   0.586720  -2.463 0.013879 *  
stateVirginia       -0.170000   0.586720  -0.290 0.772045    
stateWashington      0.020000   0.586720   0.034 0.972811    
stateWest Virginia  -0.920000   0.586720  -1.568 0.117052    
stateWisconsin      -0.852500   0.586720  -1.453 0.146405    
stateWyoming        -0.945000   0.586720  -1.611 0.107436    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.624 on 1754 degrees of freedom
Multiple R-squared:  0.1037,    Adjusted R-squared:  0.08068 
F-statistic: 4.509 on 45 and 1754 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="machine-learning-model-training" class="level3">
<h3 class="anchored" data-anchor-id="machine-learning-model-training">Machine Learning Model Training</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Split the data into training and test sets</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12072024</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the index for 80% training and 20% testing</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(p1_education<span class="sc">$</span>oty_month3_emplvl_pct_chg, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>train_education_data <span class="ot">&lt;-</span> p1_education[train_index, ]</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>test_education_data <span class="ot">&lt;-</span> p1_education[<span class="sc">-</span>train_index, ]</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Machine learning model: Linear regression model to predict a country's GINI inedex </span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the training control (10-fold cross-validation)</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>train_education_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Train the model using caret or tiny models</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>lm_model_education <span class="ot">&lt;-</span> <span class="fu">train</span>(oty_month3_emplvl_pct_chg <span class="sc">~</span> year_quarter_cont <span class="sc">+</span> state, </span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> train_education_data,</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"lm"</span>,      </span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trControl =</span> train_education_control)</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Understand model results</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_model_education)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-17.2398  -0.6117   0.3261   1.2971   7.6251 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            1.633137   0.462466   3.531 0.000427 ***
year_quarter_cont      0.009422   0.006002   1.570 0.116718    
stateFlorida           0.839555   0.668087   1.257 0.209089    
stateGeorgia           1.232797   0.644473   1.913 0.055968 .  
stateHawaii           -0.511644   0.655655  -0.780 0.435314    
stateIdaho             1.467974   0.639350   2.296 0.021821 *  
stateIllinois         -0.649320   0.649880  -0.999 0.317901    
stateIndiana          -0.465841   0.634500  -0.734 0.462959    
stateIowa             -1.375696   0.661657  -2.079 0.037784 *  
stateKansas           -0.757782   0.655608  -1.156 0.247942    
stateKentucky         -0.166310   0.675020  -0.246 0.805426    
stateLouisiana        -0.102861   0.634493  -0.162 0.871239    
stateMaine            -1.208096   0.655610  -1.843 0.065584 .  
stateMaryland         -0.946301   0.650017  -1.456 0.145670    
stateMassachusetts    -0.679072   0.707281  -0.960 0.337163    
stateMichigan         -1.007150   0.649902  -1.550 0.121442    
stateMinnesota        -0.324423   0.661659  -0.490 0.623987    
stateMississippi      -0.109842   0.644499  -0.170 0.864697    
stateMissouri         -0.367304   0.621308  -0.591 0.554496    
stateMontana          -0.200236   0.625492  -0.320 0.748921    
stateNebraska         -0.399878   0.644503  -0.620 0.535067    
stateNevada            1.985079   0.639369   3.105 0.001943 ** 
`stateNew Hampshire`  -0.944643   0.649909  -1.454 0.146309    
`stateNew Jersey`     -0.040877   0.639378  -0.064 0.949034    
`stateNew Mexico`      0.086122   0.661667   0.130 0.896460    
`stateNew York`        0.091987   0.649973   0.142 0.887476    
`stateNorth Carolina`  0.289076   0.639354   0.452 0.651240    
`stateNorth Dakota`   -0.436108   0.634498  -0.687 0.491991    
stateOhio             -0.978626   0.634536  -1.542 0.123235    
stateOklahoma         -0.229365   0.668127  -0.343 0.731428    
stateOregon            0.778097   0.639352   1.217 0.223807    
statePennsylvania     -0.216582   0.625490  -0.346 0.729200    
`statePuerto Rico`    -1.680519   0.644480  -2.608 0.009216 ** 
`stateRhode Island`   -1.148955   0.639355  -1.797 0.072543 .  
`stateSouth Carolina`  1.207285   0.634506   1.903 0.057283 .  
`stateSouth Dakota`   -0.348111   0.644515  -0.540 0.589205    
stateTennessee         0.103995   0.629885   0.165 0.868888    
stateTexas             0.778214   0.634493   1.227 0.220213    
stateUtah              1.477658   0.644499   2.293 0.022012 *  
stateVermont          -1.443273   0.629923  -2.291 0.022101 *  
`stateVirgin Islands` -0.944037   0.634493  -1.488 0.137013    
stateVirginia         -0.640512   0.661702  -0.968 0.333224    
stateWashington        0.359745   0.644472   0.558 0.576797    
`stateWest Virginia`  -0.968253   0.649888  -1.490 0.136483    
stateWisconsin        -0.911640   0.634514  -1.437 0.151012    
stateWyoming          -0.908406   0.629880  -1.442 0.149474    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.635 on 1395 degrees of freedom
Multiple R-squared:  0.09548,   Adjusted R-squared:  0.0663 
F-statistic: 3.272 on 45 and 1395 DF,  p-value: 5.313e-12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assess the model performance both the training and test dataset using Root mean squared error (RMSE)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Make predictions on the test set</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>predictions_education <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model_education, <span class="at">newdata =</span> test_education_data)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Combine actual vs predicted values</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>results_education <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Actual =</span> test_education_data<span class="sc">$</span>oty_month3_emplvl_pct_chg, <span class="at">Predicted =</span> predictions_education)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="do">## View the results</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(results_education)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Actual Predicted
1    3.9 3.1105325
2    0.0 1.1767173
3    0.2 0.8847763
4    1.9 0.9634868
5    4.0 3.6276372
6    2.2 2.4206551</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate RMSE, R-squared, and MAE</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>model_eval_education <span class="ot">&lt;-</span> <span class="fu">postResample</span>(predictions_education, test_education_data<span class="sc">$</span>oty_month3_emplvl_pct_chg)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="do">## View performance metrics</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(p1_education<span class="sc">$</span>oty_month3_emplvl_pct_chg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-16.400   0.700   1.900   1.601   3.000   9.500 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_eval_education)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     RMSE  Rsquared       MAE 
2.6274199 0.1045496 1.7165344 </code></pre>
</div>
</div>
</section>
</section>
<section id="predict-outcome" class="level2">
<h2 class="anchored" data-anchor-id="predict-outcome">Predict Outcome</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the time period</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">2024</span><span class="sc">:</span><span class="dv">2025</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>quarters <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Q_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>year_quarters <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">outer</span>(years, quarters, paste, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>year_quarter_cont <span class="ot">&lt;-</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">144</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the states and territories</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Delaware"</span>, <span class="st">"Florida"</span>, <span class="st">"Georgia"</span>, <span class="st">"Hawaii"</span>, <span class="st">"Idaho"</span>, <span class="st">"Illinois"</span>, <span class="st">"Indiana"</span>, <span class="st">"Iowa"</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kansas"</span>, <span class="st">"Kentucky"</span>, <span class="st">"Louisiana"</span>, <span class="st">"Maine"</span>, <span class="st">"Maryland"</span>, <span class="st">"Massachusetts"</span>, <span class="st">"Michigan"</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Minnesota"</span>, <span class="st">"Mississippi"</span>, <span class="st">"Missouri"</span>, <span class="st">"Montana"</span>, <span class="st">"Nebraska"</span>, <span class="st">"Nevada"</span>, </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New Hampshire"</span>, <span class="st">"New Jersey"</span>, <span class="st">"New Mexico"</span>, <span class="st">"New York"</span>, <span class="st">"North Carolina"</span>, </span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"North Dakota"</span>, <span class="st">"Ohio"</span>, <span class="st">"Oklahoma"</span>, <span class="st">"Oregon"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"Rhode Island"</span>, </span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"South Carolina"</span>, <span class="st">"South Dakota"</span>, <span class="st">"Tennessee"</span>, <span class="st">"Texas"</span>, <span class="st">"Utah"</span>, <span class="st">"Vermont"</span>, </span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Virginia"</span>, <span class="st">"Washington"</span>, <span class="st">"West Virginia"</span>, <span class="st">"Wisconsin"</span>, <span class="st">"Wyoming"</span>, <span class="st">"Puerto Rico"</span>, </span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Virgin Islands"</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the data frame</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>future_data_part2_education <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">year_quarter_cont =</span> year_quarter_cont , <span class="at">state =</span> locations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Predict outcome up to 2050</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict outcomes for future_data</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>future_data_part2_education<span class="sc">$</span>predicted_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model_education, <span class="at">newdata =</span> future_data_part2_education)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert year_quarter_cont to readable year/quarter</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Example numeric vector</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">144</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the starting year and quarter</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>start_year <span class="ot">&lt;-</span> <span class="dv">2024</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>start_quarter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the year_quarter values</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>convert_to_year_quarter <span class="ot">&lt;-</span> <span class="cf">function</span>(x, start_year, start_quarter) {</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the year and quarter</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> start_year <span class="sc">+</span> (x <span class="sc">-</span> <span class="dv">40</span>) <span class="sc">%/%</span> <span class="dv">4</span>  <span class="co"># Start year incremented by full 4 quarters</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  quarter <span class="ot">&lt;-</span> start_quarter <span class="sc">+</span> (x <span class="sc">-</span> <span class="dv">40</span>) <span class="sc">%%</span> <span class="dv">4</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Handle overflow in quarters</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (quarter <span class="sc">&gt;</span> <span class="dv">4</span>) {</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    year <span class="ot">&lt;-</span> year <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    quarter <span class="ot">&lt;-</span> quarter <span class="sc">%%</span> <span class="dv">4</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the year_quarter label</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(year, <span class="st">"_Q"</span>, quarter)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to the values</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>year_quarter <span class="ot">&lt;-</span> <span class="fu">sapply</span>(values, convert_to_year_quarter, <span class="at">start_year =</span> <span class="dv">2024</span>, <span class="at">start_quarter =</span> <span class="dv">1</span>)</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Output</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>year_quarter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "2024_Q1" "2024_Q2" "2024_Q3" "2024_Q4" "2025_Q1" "2025_Q2" "2025_Q3"
  [8] "2025_Q4" "2026_Q1" "2026_Q2" "2026_Q3" "2026_Q4" "2027_Q1" "2027_Q2"
 [15] "2027_Q3" "2027_Q4" "2028_Q1" "2028_Q2" "2028_Q3" "2028_Q4" "2029_Q1"
 [22] "2029_Q2" "2029_Q3" "2029_Q4" "2030_Q1" "2030_Q2" "2030_Q3" "2030_Q4"
 [29] "2031_Q1" "2031_Q2" "2031_Q3" "2031_Q4" "2032_Q1" "2032_Q2" "2032_Q3"
 [36] "2032_Q4" "2033_Q1" "2033_Q2" "2033_Q3" "2033_Q4" "2034_Q1" "2034_Q2"
 [43] "2034_Q3" "2034_Q4" "2035_Q1" "2035_Q2" "2035_Q3" "2035_Q4" "2036_Q1"
 [50] "2036_Q2" "2036_Q3" "2036_Q4" "2037_Q1" "2037_Q2" "2037_Q3" "2037_Q4"
 [57] "2038_Q1" "2038_Q2" "2038_Q3" "2038_Q4" "2039_Q1" "2039_Q2" "2039_Q3"
 [64] "2039_Q4" "2040_Q1" "2040_Q2" "2040_Q3" "2040_Q4" "2041_Q1" "2041_Q2"
 [71] "2041_Q3" "2041_Q4" "2042_Q1" "2042_Q2" "2042_Q3" "2042_Q4" "2043_Q1"
 [78] "2043_Q2" "2043_Q3" "2043_Q4" "2044_Q1" "2044_Q2" "2044_Q3" "2044_Q4"
 [85] "2045_Q1" "2045_Q2" "2045_Q3" "2045_Q4" "2046_Q1" "2046_Q2" "2046_Q3"
 [92] "2046_Q4" "2047_Q1" "2047_Q2" "2047_Q3" "2047_Q4" "2048_Q1" "2048_Q2"
 [99] "2048_Q3" "2048_Q4" "2049_Q1" "2049_Q2" "2049_Q3" "2049_Q4" "2050_Q1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example data frame</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">value =</span> values)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add year_quarter as a factor</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>future_data_part2_education<span class="sc">$</span>year_quarter <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(df<span class="sc">$</span>value, convert_to_year_quarter, <span class="at">start_year =</span> <span class="dv">2024</span>, <span class="at">start_quarter =</span> <span class="dv">1</span>),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="part-2-general-modelfunction" class="level1">
<h1>Part 2: General model/function</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generalized function for processing and modeling</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>process_and_model <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset_path, sheet_name, target_variable, predictors, <span class="at">start_year =</span> <span class="dv">2024</span>, <span class="at">start_quarter =</span> <span class="dv">1</span>, <span class="at">end_year =</span> <span class="dv">2050</span>, <span class="at">end_quarter =</span> <span class="dv">4</span>, <span class="at">seed =</span> <span class="dv">12072024</span>) {</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load the dataset</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(dataset_path, <span class="at">sheet =</span> sheet_name)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate year and quarter</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(year_quarter, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"quarter"</span>), <span class="at">sep =</span> <span class="st">"_Q_"</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create ordered factor for year_quarter</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">year_quarter_factor =</span> <span class="fu">factor</span>(</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(year, quarter, <span class="at">sep =</span> <span class="st">"_Q_"</span>),</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">paste</span>(year, quarter, <span class="at">sep =</span> <span class="st">"_Q_"</span>)),</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">year_quarter_cont =</span> <span class="fu">as.numeric</span>(year_quarter_factor)  <span class="co"># Convert factor to numeric</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split the data into training and test sets</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>  train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(data[[target_variable]], <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> data[train_index, ]</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> data[<span class="sc">-</span>train_index, ]</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the training control</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>  train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train the linear regression model</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(target_variable, <span class="st">"~"</span>, <span class="fu">paste</span>(predictors, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>  lm_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>    formula,</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> train_data,</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> train_control</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model summary</span></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(lm_model))</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make predictions on the test set</span></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model, <span class="at">newdata =</span> test_data)</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine actual vs predicted values</span></span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Actual =</span> test_data[[target_variable]], <span class="at">Predicted =</span> predictions)</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">head</span>(results))</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Evaluate model performance</span></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>  model_eval <span class="ot">&lt;-</span> <span class="fu">postResample</span>(predictions, test_data[[target_variable]])</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(model_eval)</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare future data for prediction</span></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>  unique_states <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>state)  <span class="co"># Assuming 'state' column exists in all datasets</span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate all the possible year_quarter_cont values from start to end</span></span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>  future_year_quarters <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(data<span class="sc">$</span>year_quarter_cont), </span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>                              (end_year <span class="sc">-</span> start_year) <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> end_quarter <span class="sc">-</span> start_quarter <span class="sc">+</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the future data</span></span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>  future_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_quarter_cont =</span> future_year_quarters,</span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> unique_states</span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predict outcomes for future data</span></span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>  future_data<span class="sc">$</span>predicted_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model, <span class="at">newdata =</span> future_data)</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add year_quarter as a factor</span></span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>  convert_to_year_quarter <span class="ot">&lt;-</span> <span class="cf">function</span>(x, start_year, start_quarter) {</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate year and quarter from continuous variable</span></span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>    year <span class="ot">&lt;-</span> start_year <span class="sc">+</span> (x <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%/%</span> <span class="dv">4</span>  <span class="co"># Determine the year</span></span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>    quarter <span class="ot">&lt;-</span> start_quarter <span class="sc">+</span> (x <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%%</span> <span class="dv">4</span>  <span class="co"># Determine the quarter</span></span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (quarter <span class="sc">&gt;</span> <span class="dv">4</span>) {</span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>      year <span class="ot">&lt;-</span> year <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>      quarter <span class="ot">&lt;-</span> quarter <span class="sc">%%</span> <span class="dv">4</span></span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(year, <span class="st">"_Q"</span>, quarter)  <span class="co"># Return the formatted year_quarter</span></span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply the function to convert continuous to year_quarter</span></span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>  future_data<span class="sc">$</span>year_quarter <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(future_data<span class="sc">$</span>year_quarter_cont, convert_to_year_quarter, <span class="at">start_year =</span> start_year, <span class="at">start_quarter =</span> start_quarter),</span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return results</span></span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> lm_model,</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_results =</span> results,</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">model_eval =</span> model_eval,</span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">future_data =</span> future_data</span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-2-finance-industry" class="level1">
<h1>Part 2: Finance Industry</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>finance_results <span class="ot">&lt;-</span> <span class="fu">process_and_model</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset_path =</span> <span class="st">"C:/Users/nhidi/OneDrive - Johns Hopkins/PhD/courses/second-term/Programming/final-project/data/finance.xlsx"</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet_name =</span> <span class="cn">NULL</span>,  <span class="co"># Specify sheet name if applicable</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_variable =</span> <span class="st">"oty_month3_emplvl_pct_chg"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictors =</span> <span class="fu">c</span>(<span class="st">"year_quarter_cont"</span>, <span class="st">"state"</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.9157  -0.9082   0.1344   1.0972   6.9752 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            1.193118   0.381965   3.124 0.001823 ** 
year_quarter_cont      0.009713   0.004814   2.018 0.043832 *  
stateFlorida           1.557283   0.526152   2.960 0.003131 ** 
stateGeorgia           1.041029   0.530440   1.963 0.049894 *  
stateHawaii           -1.351258   0.539793  -2.503 0.012418 *  
stateIdaho             2.112396   0.514588   4.105 4.28e-05 ***
stateIllinois         -0.673877   0.526148  -1.281 0.200485    
stateIndiana          -0.065423   0.530440  -0.123 0.901858    
stateIowa             -0.966344   0.511094  -1.891 0.058866 .  
stateKansas           -0.960164   0.539799  -1.779 0.075499 .  
stateKentucky         -0.512501   0.526149  -0.974 0.330195    
stateLouisiana        -1.845127   0.522105  -3.534 0.000423 ***
stateMaine            -1.121454   0.534986  -2.096 0.036241 *  
stateMaryland         -2.351047   0.522092  -4.503 7.25e-06 ***
stateMassachusetts    -0.751395   0.518255  -1.450 0.147324    
stateMichigan         -0.409274   0.530456  -0.772 0.440510    
stateMinnesota        -1.595618   0.522089  -3.056 0.002284 ** 
stateMississippi      -1.005998   0.518234  -1.941 0.052434 .  
stateMissouri         -0.192832   0.530454  -0.364 0.716270    
stateMontana           0.163512   0.511092   0.320 0.749072    
stateNebraska         -1.368996   0.534978  -2.559 0.010603 *  
stateNevada            1.761161   0.526173   3.347 0.000838 ***
`stateNew Hampshire`  -1.817268   0.526174  -3.454 0.000569 ***
`stateNew Jersey`     -0.682399   0.504624  -1.352 0.176501    
`stateNew Mexico`     -0.831262   0.534977  -1.554 0.120452    
`stateNew York`       -0.537996   0.511100  -1.053 0.292695    
`stateNorth Carolina`  2.817299   0.522084   5.396 7.98e-08 ***
`stateNorth Dakota`   -1.115699   0.534992  -2.085 0.037210 *  
stateOhio              0.139982   0.526186   0.266 0.790254    
stateOklahoma         -1.020703   0.530442  -1.924 0.054526 .  
stateOregon           -0.799787   0.526147  -1.520 0.128716    
statePennsylvania     -0.471304   0.526179  -0.896 0.370562    
`statePuerto Rico`    -1.088816   0.550326  -1.978 0.048069 *  
`stateRhode Island`   -0.836376   0.544902  -1.535 0.125032    
`stateSouth Carolina`  0.715131   0.511094   1.399 0.161970    
`stateSouth Dakota`   -2.010770   0.522089  -3.851 0.000123 ***
stateTennessee         1.050644   0.534994   1.964 0.049746 *  
stateTexas             1.289534   0.526148   2.451 0.014372 *  
stateUtah              1.645212   0.514583   3.197 0.001419 ** 
stateVermont          -1.670707   0.539787  -3.095 0.002006 ** 
`stateVirgin Islands` -3.342495   0.514574  -6.496 1.15e-10 ***
stateVirginia         -0.234057   0.556120  -0.421 0.673911    
stateWashington        0.108208   0.522084   0.207 0.835836    
`stateWest Virginia`  -1.246772   0.514585  -2.423 0.015525 *  
stateWisconsin        -0.829092   0.534983  -1.550 0.121427    
stateWyoming          -1.396556   0.530439  -2.633 0.008561 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.121 on 1397 degrees of freedom
Multiple R-squared:  0.2658,    Adjusted R-squared:  0.2421 
F-statistic: 11.24 on 45 and 1397 DF,  p-value: &lt; 2.2e-16

  Actual   Predicted
1    1.8  1.20283062
2    2.3  3.31522652
3    0.0  0.69032938
4   -0.8 -0.64229620
5   -4.6  0.08137697
6    5.1  0.08713128
     RMSE  Rsquared       MAE 
2.1285594 0.1442656 1.4836850 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>future_data_finance <span class="ot">&lt;-</span> finance_results<span class="sc">$</span>future_data</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows where all values are identical</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>future_data_finance <span class="ot">&lt;-</span> future_data_finance <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Part 2: Information Industry</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>information_results <span class="ot">&lt;-</span> <span class="fu">process_and_model</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset_path =</span> <span class="st">"C:/Users/nhidi/OneDrive - Johns Hopkins/PhD/courses/second-term/Programming/final-project/data/information.xlsx"</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet_name =</span> <span class="cn">NULL</span>,  <span class="co"># Specify sheet name if applicable</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_variable =</span> <span class="st">"oty_month3_emplvl_pct_chg"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictors =</span> <span class="fu">c</span>(<span class="st">"year_quarter_cont"</span>, <span class="st">"state"</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-31.3286  -2.3652   0.3013   2.7894  31.2086 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           -4.63175    1.10897  -4.177 3.14e-05 ***
year_quarter_cont      0.07394    0.01364   5.423 6.90e-08 ***
stateFlorida           3.97557    1.49176   2.665 0.007787 ** 
stateGeorgia           4.60212    1.48103   3.107 0.001926 ** 
stateHawaii            3.11664    1.50305   2.074 0.038304 *  
stateIdaho             3.84141    1.57000   2.447 0.014537 *  
stateIllinois          2.54448    1.49177   1.706 0.088290 .  
stateIndiana           0.12795    1.48103   0.086 0.931167    
stateIowa             -0.55029    1.47116  -0.374 0.708421    
stateKansas           -0.23683    1.47091  -0.161 0.872110    
stateKentucky          1.67597    1.46132   1.147 0.251625    
stateLouisiana         1.20493    1.50295   0.802 0.422858    
stateMaine             4.42344    1.50309   2.943 0.003305 ** 
stateMaryland          2.15999    1.49168   1.448 0.147835    
stateMassachusetts     4.01733    1.47090   2.731 0.006390 ** 
stateMichigan          4.46287    1.48105   3.013 0.002631 ** 
stateMinnesota         1.64516    1.46128   1.126 0.260429    
stateMississippi       0.54735    1.57006   0.349 0.727427    
stateMissouri          2.78201    1.49172   1.865 0.062395 .  
stateMontana           1.14931    1.52765   0.752 0.451973    
stateNebraska          3.13342    1.49184   2.100 0.035875 *  
stateNevada            9.59248    1.52751   6.280 4.52e-10 ***
`stateNew Hampshire`   3.34608    1.49188   2.243 0.025062 *  
`stateNew Jersey`      3.28509    1.56992   2.093 0.036572 *  
`stateNew Mexico`      1.23786    1.57002   0.788 0.430575    
`stateNew York`        3.30257    1.49171   2.214 0.026993 *  
`stateNorth Carolina`  5.25249    1.50296   3.495 0.000489 ***
`stateNorth Dakota`    0.86921    1.49168   0.583 0.560185    
stateOhio              2.19178    1.48110   1.480 0.139143    
stateOklahoma          1.19385    1.48126   0.806 0.420397    
stateOregon            5.11604    1.54088   3.320 0.000923 ***
statePennsylvania      4.21459    1.50300   2.804 0.005115 ** 
`statePuerto Rico`     2.28729    1.49172   1.533 0.125423    
`stateRhode Island`   -0.47569    1.55486  -0.306 0.759698    
`stateSouth Carolina`  3.79261    1.51498   2.503 0.012413 *  
`stateSouth Dakota`    1.17112    1.47092   0.796 0.426062    
stateTennessee         5.63050    1.56992   3.586 0.000347 ***
stateTexas             4.78691    1.47089   3.254 0.001163 ** 
stateUtah              5.68440    1.51491   3.752 0.000182 ***
stateVermont           2.85277    1.52747   1.868 0.062021 .  
`stateVirgin Islands` -2.04276    1.50296  -1.359 0.174315    
stateVirginia          2.84157    1.51502   1.876 0.060920 .  
stateWashington        7.81631    1.51492   5.160 2.83e-07 ***
`stateWest Virginia`   1.55320    1.51496   1.025 0.305426    
stateWisconsin         3.06430    1.47090   2.083 0.037407 *  
stateWyoming           1.14075    1.48105   0.770 0.441295    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.964 on 1397 degrees of freedom
Multiple R-squared:  0.1365,    Adjusted R-squared:  0.1087 
F-statistic: 4.907 on 45 and 1397 DF,  p-value: &lt; 2.2e-16

  Actual  Predicted
1    1.8 -0.5822403
2   -0.1 -2.0133329
3    2.4 -4.0104554
4   -6.7 -3.4084964
5   -2.0 -1.2727168
6   -5.2 -3.3199497
      RMSE   Rsquared        MAE 
6.08793255 0.08708642 4.14176462 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>future_data_information <span class="ot">&lt;-</span> information_results<span class="sc">$</span>future_data</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows where all values are identical</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>future_data_information <span class="ot">&lt;-</span> future_data_information <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-2-leisure-industry" class="level1">
<h1>Part 2: Leisure Industry</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>leisure_results <span class="ot">&lt;-</span> <span class="fu">process_and_model</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset_path =</span> <span class="st">"C:/Users/nhidi/OneDrive - Johns Hopkins/PhD/courses/second-term/Programming/final-project/data/leisure.xlsx"</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet_name =</span> <span class="cn">NULL</span>,  <span class="co"># Specify sheet name if applicable</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_variable =</span> <span class="st">"oty_month3_emplvl_pct_chg"</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictors =</span> <span class="fu">c</span>(<span class="st">"year_quarter_cont"</span>, <span class="st">"state"</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-62.496  -0.672   0.934   2.742  93.075 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)           -1.069823   2.141427  -0.500  0.61745   
year_quarter_cont      0.082293   0.026530   3.102  0.00196 **
stateFlorida           1.793609   2.966264   0.605  0.54550   
stateGeorgia           0.974447   2.918506   0.334  0.73852   
stateHawaii            2.243916   2.941801   0.763  0.44573   
stateIdaho             3.169235   2.966017   1.069  0.28547   
stateIllinois          0.625358   2.991887   0.209  0.83446   
stateIndiana           0.246748   2.896677   0.085  0.93213   
stateIowa             -0.519131   2.896979  -0.179  0.85781   
stateKansas            0.270115   2.918650   0.093  0.92628   
stateKentucky          0.590595   2.819981   0.209  0.83414   
stateLouisiana         0.772123   2.992512   0.258  0.79643   
stateMaine             2.352440   2.918550   0.806  0.42036   
stateMaryland          2.520427   2.942081   0.857  0.39177   
stateMassachusetts     0.517965   2.919009   0.177  0.85918   
stateMichigan          0.843115   2.897263   0.291  0.77109   
stateMinnesota         1.506373   2.897082   0.520  0.60317   
stateMississippi      -0.007886   2.856322  -0.003  0.99780   
stateMissouri          1.808334   2.941579   0.615  0.53882   
stateMontana           1.792707   2.856408   0.628  0.53036   
stateNebraska          0.536099   2.918611   0.184  0.85429   
stateNevada            1.068022   2.838478   0.376  0.70678   
`stateNew Hampshire`   1.438966   2.877040   0.500  0.61704   
`stateNew Jersey`      1.416827   2.918757   0.485  0.62745   
`stateNew Mexico`      1.288221   2.837918   0.454  0.64995   
`stateNew York`        1.516260   2.942147   0.515  0.60638   
`stateNorth Carolina`  1.184466   2.897231   0.409  0.68273   
`stateNorth Dakota`   -1.344205   2.966476  -0.453  0.65052   
stateOhio              0.701386   2.897110   0.242  0.80874   
stateOklahoma          1.032604   2.897314   0.356  0.72159   
stateOregon            1.870275   2.966264   0.631  0.52846   
statePennsylvania      2.106804   2.918503   0.722  0.47049   
`statePuerto Rico`     1.659266   2.991987   0.555  0.57928   
`stateRhode Island`    1.758654   2.919672   0.602  0.54704   
`stateSouth Carolina`  1.651439   2.942996   0.561  0.57479   
`stateSouth Dakota`   -0.661424   2.991987  -0.221  0.82507   
stateTennessee         1.561099   2.918611   0.535  0.59282   
stateTexas             2.500416   2.856335   0.875  0.38151   
stateUtah              3.211040   2.856469   1.124  0.26115   
stateVermont           0.838312   2.918642   0.287  0.77398   
`stateVirgin Islands`  0.765528   2.896912   0.264  0.79162   
stateVirginia          2.414299   2.896667   0.833  0.40472   
stateWashington        2.247740   2.966356   0.758  0.44873   
`stateWest Virginia`  -0.298591   2.941791  -0.101  0.91917   
stateWisconsin         0.703163   3.079899   0.228  0.81944   
stateWyoming           0.632389   2.918519   0.217  0.82849   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11.58 on 1395 degrees of freedom
Multiple R-squared:  0.01399,   Adjusted R-squared:  -0.01782 
F-statistic: 0.4397 on 45 and 1395 DF,  p-value: 0.9996

  Actual   Predicted
1    4.5  0.80607921
2    4.1 -0.01308243
3    0.7 -0.71741403
4    3.7 -0.21540678
5    0.7  1.36491095
6    1.8  1.53289736
        RMSE     Rsquared          MAE 
1.041453e+01 9.978943e-06 5.442494e+00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>future_data_leisure <span class="ot">&lt;-</span> leisure_results<span class="sc">$</span>future_data</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows where all values are identical</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>future_data_leisure <span class="ot">&lt;-</span> future_data_leisure <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-2-professional-industry" class="level1">
<h1>Part 2: Professional Industry</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>professional_results <span class="ot">&lt;-</span> <span class="fu">process_and_model</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset_path =</span> <span class="st">"C:/Users/nhidi/OneDrive - Johns Hopkins/PhD/courses/second-term/Programming/final-project/data/professional.xlsx"</span>,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet_name =</span> <span class="cn">NULL</span>,  <span class="co"># Specify sheet name if applicable</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_variable =</span> <span class="st">"oty_month3_emplvl_pct_chg"</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictors =</span> <span class="fu">c</span>(<span class="st">"year_quarter_cont"</span>, <span class="st">"state"</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-17.3129  -1.5514   0.0992   1.6838  18.6658 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            1.111131   0.677048   1.641 0.100994    
year_quarter_cont     -0.002408   0.008331  -0.289 0.772551    
stateFlorida           2.876540   0.915886   3.141 0.001721 ** 
stateGeorgia           1.486746   0.902980   1.646 0.099888 .  
stateHawaii           -2.551228   0.930241  -2.743 0.006174 ** 
stateIdaho             2.280265   0.915778   2.490 0.012891 *  
stateIllinois         -0.537308   0.909285  -0.591 0.554675    
stateIndiana           0.560794   0.922723   0.608 0.543446    
stateIowa             -0.285888   0.897158  -0.319 0.750032    
stateKansas           -0.528280   0.915972  -0.577 0.564206    
stateKentucky         -0.691751   0.954676  -0.725 0.468824    
stateLouisiana        -0.341395   0.930255  -0.367 0.713682    
stateMaine             1.332661   0.937660   1.421 0.155464    
stateMaryland          0.055400   0.984157   0.056 0.955117    
stateMassachusetts     1.329729   0.937663   1.418 0.156376    
stateMichigan         -0.364436   0.963856  -0.378 0.705412    
stateMinnesota         0.017217   0.929948   0.019 0.985232    
stateMississippi       0.564817   0.909417   0.621 0.534651    
stateMissouri         -0.343004   0.937808  -0.366 0.714606    
stateMontana           1.671163   0.891514   1.875 0.061067 .  
stateNebraska          0.717650   0.915817   0.784 0.433397    
stateNevada            2.564383   0.915759   2.800 0.005176 ** 
`stateNew Hampshire`   2.481525   0.963942   2.574 0.010145 *  
`stateNew Jersey`      0.587888   0.909234   0.647 0.518013    
`stateNew Mexico`      0.933240   0.915837   1.019 0.308379    
`stateNew York`        0.392801   0.903210   0.435 0.663706    
`stateNorth Carolina`  2.104919   0.886170   2.375 0.017669 *  
`stateNorth Dakota`   -0.539634   0.915830  -0.589 0.555803    
stateOhio             -0.373908   0.897205  -0.417 0.676927    
stateOklahoma          0.665230   0.937719   0.709 0.478187    
stateOregon            1.397901   0.915752   1.527 0.127110    
statePennsylvania      0.090911   0.902989   0.101 0.919821    
`statePuerto Rico`     0.870621   0.922745   0.944 0.345582    
`stateRhode Island`    0.235631   0.937735   0.251 0.801637    
`stateSouth Carolina`  1.571765   0.909202   1.729 0.084079 .  
`stateSouth Dakota`    1.348653   0.954752   1.413 0.158005    
stateTennessee         2.394133   0.929985   2.574 0.010144 *  
stateTexas             3.153576   0.915799   3.444 0.000591 ***
stateUtah              2.259855   0.915807   2.468 0.013721 *  
stateVermont           1.612210   0.954543   1.689 0.091446 .  
`stateVirgin Islands` -1.631162   0.915742  -1.781 0.075090 .  
stateVirginia          0.622224   0.909322   0.684 0.493917    
stateWashington        4.422454   0.945950   4.675 3.22e-06 ***
`stateWest Virginia`  -0.041677   0.915759  -0.046 0.963706    
stateWisconsin        -0.042918   0.915743  -0.047 0.962626    
stateWyoming           0.945711   0.937739   1.009 0.313388    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.661 on 1396 degrees of freedom
Multiple R-squared:  0.1148,    Adjusted R-squared:  0.08626 
F-statistic: 4.023 on 45 and 1396 DF,  p-value: &lt; 2.2e-16

  Actual Predicted
1    3.4 3.9852623
2    4.4 3.3889875
3    3.3 0.5714149
4    5.8 0.5804425
5    5.3 0.4169722
6    2.4 0.7673279
     RMSE  Rsquared       MAE 
3.3497227 0.0289074 2.4169769 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>future_data_professional <span class="ot">&lt;-</span> professional_results<span class="sc">$</span>future_data</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows where all values are identical</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>future_data_professional <span class="ot">&lt;-</span> future_data_professional <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Export data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine future data for all industries for creating an interactive map in the dashboard</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new column named 'industry' with the value 'finance' for all rows</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>future_data_finance<span class="sc">$</span>industry <span class="ot">&lt;-</span> <span class="st">"finance"</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add an industry column with "information" for future_data_information</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>future_data_information<span class="sc">$</span>industry <span class="ot">&lt;-</span> <span class="st">"information"</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add an industry column with "leisure" for future_data_leisure</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>future_data_leisure<span class="sc">$</span>industry <span class="ot">&lt;-</span> <span class="st">"leisure"</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add an industry column with "education" for future_data_education</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>future_data_part2_education<span class="sc">$</span>industry <span class="ot">&lt;-</span> <span class="st">"education"</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add an industry column with "professional" for future_data_professional</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>future_data_professional<span class="sc">$</span>industry <span class="ot">&lt;-</span> <span class="st">"professional"</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all data frames into one</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>future_data_combined <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>  future_data_finance,</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>  future_data_information,</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  future_data_leisure,</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>  future_data_part2_education,</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>  future_data_professional</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the combined data frame as an .RData file</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(future_data_combined, <span class="at">file =</span> <span class="st">"future_data_combined.RData"</span>)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Save data for model 1: year and sex</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(future_data_b, <span class="at">file =</span> <span class="st">"future_data_b.RData"</span>)</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Save data for model 2: year, sex, and race</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(future_data, <span class="at">file =</span> <span class="st">"future_data.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>